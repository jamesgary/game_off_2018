<!DOCTYPE html>
<html>
  <head>
    <title>GAME</title>
    <link rel="stylesheet" type="text/css" href="./css/main.css">
  </head>
  <body>
    <div id="elm"></div>
    <div id="stats"></div>
    <script src="./js/main.js"></script>
    <script>
      var persistence;

      try {
        persistence = JSON.parse(localStorage.getItem("persistence"));

        if (!persistence) { fail() }
      } catch(e) {
        persistence = null;
        localStorage.removeItem("persistence");
      }

      var app = Elm.Main.init({
        node: document.getElementById('elm'),
        flags: {
          // CHANGE ME WHEN CHANGING FLAGS
          persistence: persistence,
          timestamp: Date.now(),
          windowWidth: window.innerWidth,
          windowHeight: window.innerHeight,
        }
      });

      app.ports.performEffects.subscribe(function(effects) {
        for (let i = 0; i < effects.length; i++) {
          let effect = effects[i];

          // CHANGE ME WHEN CHANGING EFFECTS
          switch (effect.id) {
            case "SAVE":
              console.log("savin");
              console.log(effect.persistence);
              localStorage.setItem("persistence", JSON.stringify(effect.persistence));
              break;
            case "HARD_RESET":
              console.log("hard resetin");
              localStorage.removeItem("persistence");
              break;
            default:
              console.error("unknown effect: " + effect);
          }
        }
      });

      (function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.getElementById("stats").appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='//rawgit.com/mrdoob/stats.js/master/build/stats.min.js';document.head.appendChild(script);})()
    </script>
  </body>
</html>
