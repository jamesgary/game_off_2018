<!DOCTYPE html>
<html>
  <head>
    <title>GAME</title>
    <link rel="stylesheet" type="text/css" href="./css/main.css">
  </head>
  <body>
    <div id="elm"></div>
    <div id="stats"></div>
    <script src="./js/main.js"></script>
    <script>
      var persistence;

      try {
        persistence = JSON.parse(localStorage.getItem("persistence"));

        if (!persistence) { fail() }
      } catch(e) {
        persistence = null;
        localStorage.removeItem("persistence");
      }

      var app = Elm.Main.init({
        node: document.getElementById('elm'),
        flags: {
          persistence: persistence,
          timestamp: Date.now(),
        }
      });

      app.ports.saveFlags.subscribe(function(persistence) {
        console.log(persistence);
        localStorage.setItem("persistence", JSON.stringify(persistence));
      });

      app.ports.hardReset.subscribe(function() {
        localStorage.removeItem("persistence");
      });

      (function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.getElementById("stats").appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='//rawgit.com/mrdoob/stats.js/master/build/stats.min.js';document.head.appendChild(script);})()
    </script>
  </body>
</html>
